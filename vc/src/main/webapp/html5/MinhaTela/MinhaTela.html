<sk-application ng-controller="MinhaTelaController as ctrl" creation-complete="ctrl.init()">
  <!DOCTYPE html>
  <html lang="pt-BR">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Atendimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
  
  </head>

  <body ng-click="ctrl.fecharMenus()" class="bg-gray-100 text-gray-800 text-base leading-relaxed"
    ng-click="ctrl.fecharMenus()">
 <!-- Loader inicial com CSS inline -->
  <div id="loading" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:white;z-index:9999;">
    <div style="width:64px;height:64px;border:4px solid #22c55e;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;"></div>
  </div>

  <style>
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>


   

    <div class="container w-full p-4 bg-white rounded shadow-lg sk-overflow-y=">
       <!-- Menu superior -->
    <nav class="flex space-x-2 border-b mt-4   ">
      <button 
        ng-class="ctrl.estaAtiva('listar') ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
        ng-click="ctrl.irPara('listar')"
        class="text-xl font-bold flex items-center px-6 py-4 rounded-t-lg">
        Atendimentos
      </button>
      <button  ng-show="ctrl.estaAtiva('incluir') || ctrl.estaAtiva('listar') "
        ng-class="ctrl.estaAtiva('incluir') ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
        ng-click="ctrl.irPara('incluir')"
        class="text-xl font-bold flex items-center px-6 py-4 rounded-t-lg">
        Novo Atendimento
      </button>
    </nav>
      <div class="flex space-x-4  mb-4">
        <!-- Botão flutuante -->
        <button ng-click="ctrl.irPara('incluir')"
          class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white p-6 hover:p-8 transition-all rounded-full shadow-lg flex items-center justify-center z-50">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </button>
      </div>

      <!-- Conteúdo com transição -->
      <div class="container-aba">
        <div class="conteudo-aba" ng-if="ctrl.estaAtiva('listar')" ng-class="{
           'slide-left-enter': ctrl.direcao === 'direita',
           'slide-left-active': ctrl.direcao === 'direita',
           'slide-right-enter': ctrl.direcao === 'esquerda',
           'slide-right-active': ctrl.direcao === 'esquerda'
         }">
         <!-- class min-h-screen-->
          <div class="container mx-auto p-4 bg-white rounded shadow">
            <!-- Filtro de busca -->
            <div class="flex items-center justify-between mb-4">
              <div class="relative w-1/3">
  <!-- Ícone SVG -->
  <div class="absolute inset-y-0 left-2 flex items-center pointer-events-none">
    <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height:1.25rem;"  class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z" />
    </svg>
  </div>
  
  <!-- Input -->
  <input type="text" ng-model="ctrl.filtro" placeholder="Filtrar por cliente, NF ou ocorrência..."
    class="w-full pl-8 p-2 border rounded-md focus:ring-2 focus:ring-green-500">
</div>

            </div>
            <table class="min-w-full divide-y divide-gray-200 table-auto">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Núm. </th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Cliente</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Data de Abertura</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Usuário Solicitante</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Número de Nota Fiscal</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Ocorrência</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Análise de Causa</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Tipo de Ocorrência</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Descrição</th>
                  <th class="px-2 py-3 text-left text-md font-bold text-gray-600 uppercase ">
                    Ações</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50"
                  ng-repeat="item in ctrl._dataset | filter:ctrl.filtro | startFrom:(ctrl.paginaAtual-1)*ctrl.itensPorPagina | limitTo:ctrl.itensPorPagina">

                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.NUATEND}}">
                    {{item.NUATEND}}</td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.CODPARC}}">
                    {{item.CODPARC}}</td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.DTABERTURA}}">
                    {{item.DTABERTURA}}
                  </td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.CODUSU}}">
                    {{item.CODUSU}}</td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.NUMNOTA}}">
                    {{item.NUMNOTA}}</td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.OCORRENCIA}}">
                    {{item.OCORRENCIA}}
                  </td>
                  <td ng-click="ctrl.abrirModal(item.ANALISECAUSA)"
                    class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.ANALISECAUSA}}">
                    {{ item.ANALISECAUSA.length > 20 ? item.ANALISECAUSA.substring(0,20) + '...' : item.ANALISECAUSA }}
                  </td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.TIPOOCORRENCIA}}">
                    {{item.TIPOOCORRENCIA}}</td>
                  <td class="px-2 py-2 text-md text-gray-700 truncate-tooltip" data-tooltip="{{item.CATEGORIA}}">
                    {{item.CATEGORIA}}
                  </td>
                  <td class="w-[10%] px-2 py-2 whitespace-nowrap">
                    <div class="relative inline-block text-left" ng-init="item.menuAberto = false">
                      <!-- Botão -->
                      <button ng-click="item.menuAberto = !item.menuAberto; $event.stopPropagation();"
                        class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <svg  xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 " fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" >
  <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
</svg>

                      </button>

                    <!-- Dropdown -->
<div ng-show="item.menuAberto" ng-click="$event.stopPropagation()"
     class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-xl shadow-xl z-50
            transform transition duration-200 ease-out origin-top-right"
     ng-class="{
         'opacity-100 scale-100': item.menuAberto,
         'opacity-0 scale-95 pointer-events-none': !item.menuAberto
     }">
    <button 
        class="flex gap-2  block w-full text-left px-4 py-3 text-md text-gray-700 hover:bg-gray-100 transition-colors rounded-t-xl">
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
</svg>editar

    </button>
    <button ng-click="ctrl.excluir(item)"
        class=" flex gap-2 block w-full text-left px-4 py-3 text-md text-red-600 hover:bg-red-100 transition-colors rounded-b-xl">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>excluir

    </button>
</div>


                    </div>
                  </td>

                </tr>
              </tbody>
            </table>
            <!-- Paginação -->
            <div class="flex gap-4 items-center mt-4 w-48">
              <button ng-disabled="ctrl.paginaAtual === 1" ng-click="ctrl.paginaAtual = ctrl.paginaAtual - 1"
                class="cursor-pointer px-3  py-1 bg-gray-200 rounded disabled:opacity-50">◀</button>

              <span class="text-gray-700">Pág {{ctrl.paginaAtual}}</span>

              <button
                ng-disabled="(ctrl.paginaAtual * ctrl.itensPorPagina) >= (ctrl._dataset | filter:ctrl.filtro).length"
                ng-click="ctrl.paginaAtual = ctrl.paginaAtual + 1"
                class="cursor-pointer px-3 py-1 bg-gray-200 rounded disabled:opacity-50">▶</button>
            </div>
          </div>

        </div>

        <div class="conteudo-aba" ng-show="ctrl.estaAtiva('incluir')" ng-class="{
   'slide-left-enter': ctrl.direcao === 'direita',
   'slide-left-active': ctrl.direcao === 'direita',
   'slide-right-enter': ctrl.direcao === 'esquerda',
   'slide-right-active': ctrl.direcao === 'esquerda'
 }">
          <div class="w-full max-w-8xl p-6 bg-white rounded-lg shadow-lg">
            <!-- Timeline -->
            <div class="timeline-container">
              <div class="timeline-connector"></div>
              <div class="timeline-progress" id="progress-bar" style="width: {{ctrl.progressWidth}}%"></div>
              <div class="timeline-step" ng-repeat="step in ctrl.steps" ng-click="ctrl.setActiveStep(step.number)"
                data-step="{{step.number}}">
                <div class="timeline-circle" ng-class="{ 'active': ctrl.activeStep >= step.number }">{{step.number}}
                </div>
                <div class="timeline-label">{{step.label}}</div>
              </div>
            </div>

            <!-- Formulários -->
            <div class="form-container mt-8">
              <div class="form-section" ng-class="{ 'active': ctrl.activeStep === 1 }" id="step-1">
                <h2 class="text-2xl font-bold mb-4">Solicitação</h2>
                <hr>
                <br>
                <div class="columns-2 space-y-4">
                  <div>
                    <label class="block text font-medium text-gray-700" for="nf">Nota Fiscal</label>
                    <input type="text" class="mt-1 block w-full p-3 border rounded-md" id="nf"
                      placeholder="Número da NF">
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700" for="cliente">Cliente</label>
                    <input type="text" class="mt-1 block w-full p-3 border rounded-md" id="cliente" disabled>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700" for="dtabertura">Data de Abertura</label>
                    <input type="date" class="mt-1 block w-full p-2 border rounded-md" id="dtabertura" disabled>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Solicitante</label>
                    <input type="date" class="mt-1 block w-full p-2 border rounded-md" disabled>
                  </div>
                </div>
                <div class="space-y-4">
                  <div>
                    <label class="block text font-medium text-gray-700">Ocorrência</label>
                    <textarea type="text" class="mt-1 block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Análise da Causa</label>
                    <textarea type="text" class="mt-1 block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                </div>
                <br>
                <hr>
                <br>
                <button class="w-full bg-green-600 text-white p-2 rounded-md hover:bg-green-700">Salvar</button>
              </div>
              <div class="form-section" ng-class="{ 'active': ctrl.activeStep === 2 }" id="step-2">
                <h2 class="text-2xl font-bold mb-4">Qualidade</h2>
                <hr>
                <br>
                <div class="space-y-4">
                  <div>
                    <label class="block text font-medium text-gray-700">Categoria Chamado</label>
                    <select name="categoria_chamado" id="categoria_chamado"
                      class="mt-1 block w-full p-2 border rounded-md">
                      <option value="" selected>Selecione uma opção</option>
                      <option value="RAC">Registro de Atendimento ao Cliente</option>
                      <option value="NC">Tratamento de Não Conformidade</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Observações</label>
                    <textarea type="text" class="mt-1 block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                  <button class="w-full bg-green-600 text-white p-2 rounded-md hover:bg-green-700">Salvar</button>
                </div>
              </div>
              <div class="form-section" ng-class="{ 'active': ctrl.activeStep === 3 }" id="step-3">
                <h2 class="text-2xl font-bold mb-4">Aprovações</h2>
                <hr>
                <br>
                <div class="space-y-4">
                  <div>
                    <label class="toggle-label text font-medium text-gray-700">
                      <input type="checkbox" class="toggle-checkbox">
                      <span class="toggle-switch"></span>
                      Todos os documentos foram recebidos?
                    </label>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Ação imediata</label>
                    <textarea type="text" class="block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                </div>
                <br>
                <div class="space-y-4">
                  <div>
                    <h3><b>Aprovação Comercial</b></h3>
                    <hr>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Aprovação (Comercial)</label>
                    <input type="text" class="mt-1 block w-full p-2 border rounded-md" placeholder="Seu cargo">
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Data/Hora de Aprovação(Comercial)</label>
                    <input type="text" class="mt-1 block w-full p-2 border rounded-md" placeholder="Nome da empresa">
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Justificativa</label>
                    <textarea type="text" class="mt-1 block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                </div>
                <br>
                <div class="space-y-4">
                  <div>
                    <h3><b>Aprovação Financeiro</b></h3>
                    <hr>
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Aprovação(Financeiro)</label>
                    <input type="text" class="mt-1 block w-full p-2 border rounded-md" placeholder="Seu cargo">
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Data/Hora de Aprovação(Financeiro)</label>
                    <input type="text" class="mt-1 block w-full p-2 border rounded-md" placeholder="Nome da empresa">
                  </div>
                  <div>
                    <label class="block text font-medium text-gray-700">Justificativa</label>
                    <textarea type="text" class="mt-1 block w-full p-2 border rounded-md" rows="5"></textarea>
                  </div>
                  <button class="w-full bg-green-600 text-white p-2 rounded-md hover:bg-green-700">Salvar</button>
                </div>
                <hr>
                <br>
              </div>
              <div class="form-section" ng-class="{ 'active': ctrl.activeStep === 4 }" id="step-4">
                <h2 class="text-2xl font-bold mb-4">Financeiro</h2>
                <div class="space-y-4">
                  <p class="text-gray-600">Por favor, revise todas as informações fornecidas antes de enviar.</p>
                  <div>
                    <label class="block text font-medium text-gray-700">Comentários Adicionais</label>
                    <textarea class="mt-1 block w-full p-2 border rounded-md" rows="4"
                      placeholder="Algum comentário?"></textarea>
                  </div>
                  <button class="w-full bg-green-600 text-white p-2 rounded-md hover:bg-green-700">Salvar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal -->
      <div ng-show="ctrl.modalAberto"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white w-1/2 p-6 rounded-lg shadow-lg relative">


          <div class="flex justify-between items-center ">
            <h2 class="text-xl font-bold mb-4">Análise de Causa</h2>

            <!-- Botão fechar -->
            <button class=" text-gray-600 hover:text-black font-bold" ng-click="ctrl.fecharModal()">
              ✖
            </button>
          </div>
          <p class="text-gray-700 whitespace-pre-wrap">{{ ctrl.textoModal }}</p>
        </div>
      </div>

      <script>
  document.addEventListener("DOMContentLoaded", function() {
    const loader = document.getElementById("loading");
    if (loader) {
      loader.style.transition = "opacity 0.5s";
      loader.style.opacity = "0";
      setTimeout(() => loader.remove(), 500);
    }
  });
</script>



  </body>

  </html>
</sk-application>